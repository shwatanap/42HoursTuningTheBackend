#/etc/proxysql.cnf

datadir="/var/lib/proxysql"
errorlog="/var/lib/proxysql/proxysql.log"

admin_variables=
{
        # リモート用のユーザを追記
        admin_credentials="admin:admin; radminuser:radminpass"
        mysql_ifaces="0.0.0.0:6032"
}

mysql_variables=
{
        threads=4
        max_connections=2048
        default_query_delay=0
        default_query_timeout=36000000
        have_compress=true
        poll_timeout=2000
        interfaces="0.0.0.0:6033"
        default_schema="information_schema"
        stacksize=1048576
        server_version="8"
        connect_timeout_server=3000
        monitor_username="monitor"
        monitor_password="monitor"
        monitor_history=600000
        monitor_connect_interval=60000
        monitor_ping_interval=10000
        monitor_read_only_interval=1500
        monitor_read_only_timeout=500
        ping_interval_server_msec=120000
        ping_timeout_server=500
        commands_stats=true
        sessions_sort=true
        connect_retries_on_failure=10
}

#振り分けルールです。rule_id順に評価されます。
mysql_query_rules:
(
#negate_match_patternで否定、SELECT以外をホストグループ0へ
        {
                rule_id=1
                active=1
                match_pattern="^SELECT"
                destination_hostgroup=0
                negate_match_pattern=1
                apply=1
        },
#SELECTから始まるものはホストグループ0へ
        {
                rule_id=20
                active=1
                match_pattern="^SELECT"
                destination_hostgroup=1
                apply=1
        }
)

mysql_servers=
(
  {
    hostgroup_id=0
    hostname=mysql
    port=3306
  },
  {
    hostgroup_id=1
    hostname=mysql-slave
    port=3306
  }
)

mysql_replication_hostgroups=
(
  {
    writer_hostgroup=0
    reader_hostgroup=1
    comment="this is comment"
  }
)
